<!doctype html>
<html>

<head>
    <meta charset=utf-8>
    <meta http-equiv=X-UA-Compatible content=IE=edge>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>Main</title>
    <link href=css/bootstrap.min.css rel=stylesheet>
    <link href=css/pixie-main.css rel=stylesheet>
</head>

<body>
    <div class=main-box>
        <ul class="nav nav-pills">
            <li class=active>
                <a data-toggle=pill href=#status>
                    <img src=images/status.png alt>Status</a>
            </li>
            <li id ="liNetwork">
                <a data-toggle=pill href=#network>
                    <img src=images/network.png alt>Network</a>
            </li>
            <li id="liService">
                <a data-toggle=pill href=#service>
                    <img src=images/service.png alt>Service</a>
            </li>
            <li id="liOther">
                <a data-toggle=pill href=#other>
                    <img src=images/other.png alt>Other</a>
            </li>
        </ul>
        <div class=tab-content>
            <div id=status class="tab-pane fade in active">
                <table class=table>
                    <tbody>
                        <tr>
                            <td class=border-none>MAC</td>
                            <td class=text-right id="txtmac"></td>
                        </tr>
                        <tr>
                            <td>Access point IP</td>
                            <td class=text-right id="txtmyip"> </td>
                        </tr>
                        <tr>
                            <td>Wi-Fi Network</td>
                            <td class=text-right id="wsid"> </td>
                        </tr>
                        <tr>
                            <td>WLAN WAN IP</td>
                            <td class=text-right id="localip"> </td>
                        </tr>

                    </tbody>
                </table>
                <h4>
                    <img src=images/ap.png alt>Access Point Configuration</h4>
                <form>
                    <div class=form-group> <label class="grey-text font-weight-light"> AP Name</label>
                        <input type="text" id="txtssid" class="form-control" placeholder="SSID" value="" maxlength="15" maxlength="31">
                    </div>
                    <div class=form-group> <label class="grey-text font-weight-light">AP IP</label>
                        <input type="text" id="txtaplan" class="form-control" placeholder="ip ddress" value="" maxlength="15">
                    </div>
                    <div class=form-group> <label for=defaultFormCardEmailEx class="grey-text font-weight-light">AP Password</label> 
                            <input type="password" id="txtpass" class="form-control" placeholder="Password" maxlength="31">
                    </div>
                    <input type="checkbox" onclick="Gateway_passFunction()">Show Password
                    <div class=text-center> <button class="btn btn-block" type="button" id="apply_btn"
                            title=Apply>Apply</button>
                    </div>


                    <li style="color:red; font-size: 50%; ">NOTE:Press reboot button to apply any changes on hardware </li>
                </form>
            </div>

            <div id=network class="tab-pane fade">
                <div class=panel-group id=accordion>

                    <div class="panel panel-default">
                        <div id=collapse1 class=form-group>
                            <div class=panel-body>
                                <div class=text-center>
                                    <button class="btn btn-block" type="button" id="scan_wifi" title=scan>Scan
                                        Wi-fi</button>
                                </div>
                                
                                <div class=form-group>
                                    <label>Nearby WLAN</label>
                                    <select class="mdb-select form-control" id="drpWLAN" placeholder="scan for wifi">
                                        <!-- <option value=1 placeholder="scan for wifi" ></option> -->

                                    </select>
                                </div>

                                <div class=form-group>
                                    <label for=defaultFormCardEmailEx
                                        class="grey-text font-weight-light">Password</label>
                                    <input type=password id="wifi_pass" class=form-control placeholder=Password maxlength="31"> 
                                      <input type="checkbox" onclick="Router_passFunction()">Show Password

                                </div>

                                <div class=form-group>
                                    <label>Mode</label>
                                    <select class="mdb-select-repeater form-control" id="wifi_MODE">
                                        <option value="dhcp" class=inner-dhcp-box>dhcp</option>
                                        <option value="static" class=inner-static-box>static</option>
                                    </select>
                                </div>
                                <div class=box-4>
                                    <form>
                                        <div class=form-group>
                                            <label for=defaultFormCardNameEx class="grey-text font-weight-light">
                                                <span class=require>*</span>IP Address</label>
                                            <input type=text id="txtipadd" class=form-control placeholder="IP Address" maxlength="15">
                                        </div>
                                        <div class=form-group>
                                            <label for=defaultFormCardEmailEx class="grey-text font-weight-light">
                                                <span class=require>*</span>NetMask</label>
                                            <input type=email id="net_m" class=form-control placeholder=NetMask maxlength="15"> 
                                        </div>
                                        <div class=form-group>
                                            <label for=defaultFormCardEmailEx class="grey-text font-weight-light">
                                                <span class=require>*</span>Gateway Address</label>
                                            <input type=text id="G_add" class=form-control placeholder="Gateway Address" maxlength="15"> 
                                        </div>
                                        <div class=form-group>
                                            <label for=defaultFormCardEmailEx class="grey-text font-weight-light">
                                                <span class=require>*</span>Primary DNS Address</label>
                                            <input type=text id="P_dns" class=form-control placeholder="Primary DNS Address" maxlength="15"> 
                                        </div>
                                        <div class=form-group>
                                            <label for=defaultFormCardEmailEx
                                                class="grey-text font-weight-light">Secondary DNS Address</label>
                                            <input type=text id="S_dns" class=form-control placeholder="Secondary DNS Address" maxlength="15"> 
                                        </div>
                                    </form>
                                </div>
                                <div class=text-center>
                                    <button class="btn btn-block" type="button" id="con_btn"
                                        title=Connect>Apply</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id=service class="tab-pane fade">                
                
                <div class=form-group>
                    <div class=row>
                        <div class=col-md-8> <label>NTP server address</label>
                            <input type=text id="hntp" class=form-control placeholder="NTP Address" maxlength="63">
                        </div>
                        <div class=col-md-4><label>Port</label>
                            <input type=text id="pntp" class=form-control placeholder="1883" maxlength="5" value=""> </div>
                    </div>
                </div>

                <div class=form-group>
                    <div class=row>
                        <div class=col-md-12>
                            <div class=text-center>
                                <button class="btn btn-block" type="button" id="ntp_btn" title=Apply>Apply</button>
                            </div>
                        </div>
                    </div>
                </div>


                
                <div class=form-group>
                    <div class=row>
                        <div class=col-md-8> <label>MQTT broker address</label>
                            <input type=text id="hipadd" class=form-control placeholder="Mqtt Broker Address" maxlength="63">
                        </div>
                        <div class=col-md-4><label>Port</label>
                            <input type=text id="port" class=form-control placeholder="1883" maxlength="5" value=""> 
                        </div>
                    </div>
                </div>
                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light">Client ID</label>
                    <input type=text id="c_id" class=form-control placeholder="Client ID">
                </div>

                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light">Username</label>
                    <input type=text id="U_name" class=form-control placeholder=Username maxlength="31"> 
                </div>

                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light">Password</label>
                    <input type="text" id="s_pass" class=form-control placeholder="Password OR Token" maxlength="31" > 
                </div>
                
                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light"> Publish Topic temperature</label>
                    <input type=text id="pub_topic_temp" class=form-control placeholder="Status Publish Topic" maxlength="63"> 
                </div>
                
                <div class=form-group>
                    <label>Upload Interval</label>
                    <div class=row>
                        <div class=col-md-4>
                            <input type=text id="interval_temp" class=form-control placeholder="number"> </div>
                        <div class=col-md-8>
                            <select class="mdb-select form-control" id="u_interval_temp">
                                <option value="Second">Second</option>
                                <option value="Minute">Minute</option>
                                <option value="Hour">Hour</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light"> Publish Topic timestamp</label>
                    <input type=text id="pub_topic_ping" class=form-control placeholder="Status Publish Topic" maxlength="63"> </div>

                
                <div class=form-group>
                    <label>Upload Interval</label>
                    <div class=row>
                        <div class=col-md-4>
                            <input type=text id="interval_ping" class=form-control placeholder="number"> </div>
                        <div class=col-md-8>
                            <select class="mdb-select form-control" id="u_interval_ping">
                                <option value="Second">Second</option>
                                <option value="Minute">Minute</option>
                                <option value="Hour">Hour</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light"> Subscribe Topic relay 1</label>
                    <input type=text id="sub_topic_rel1" class=form-control placeholder="Status Publish Topic" maxlength="63"> </div>
                
                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light"> Subscribe Topic relay 2</label>
                    <input type=text id="sub_topic_rel2" class=form-control placeholder="Status Publish Topic" maxlength="63"> </div>

                <div class=form-group>
                    <label for=defaultFormCardEmailEx class="grey-text font-weight-light"> Subscribe Topic enable transmission</label>
                    <input type=text id="sub_topic_en" class=form-control placeholder="Status Publish Topic" maxlength="63"> </div>

                <div class=form-group>
                    <div class=row>
                        <div class=col-md-12>
                            <div class=text-center>
                                <button class="btn btn-block" type="button" id="service_btn" title=Apply>Apply</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div id=other class="tab-pane fade">
                
                <div class=form-group>
                    <div class=row>
                        <div class=col-md-4>
                            <div class=text-center>
                                <button class="btn btn-secondary" type="button" id="getsamp1_btn" title=Apply>Get Sample</button>
                            </div>
                        </div>
                        <div class=col-md-4> 
                            <input type=text id="ical0" class=form-control placeholder="Input" >
                        </div>
                        <div class=col-md-4>
                            <input type=text id="ocal0" class=form-control placeholder="Ouput" maxlength="5" value=""> 
                        </div>
                    </div>
                </div>
                <div class=form-group>
                    <div class=row>
                        <div class=col-md-4>
                            <div class=text-center>
                                <button class="btn btn-secondary" type="button" id="getsamp2_btn" title=Apply>Get Sample</button>
                            </div>
                        </div>
                        <div class=col-md-4> 
                            <input type=text id="ical1" class=form-control placeholder="Input" >
                        </div>
                        <div class=col-md-4>
                            <input type=text id="ocal1" class=form-control placeholder="Ouput" maxlength="5" value=""> 
                        </div>
                    </div>
                    <div class="checkbox">
                        <label><input type="checkbox" id="defaultcal" >Overwrite default calibration</label>
                    </div> 
                </div>

                <div class=form-group>
                    <div class=row>
                        <div class=col-md-12>
                            <div class=text-center>
                                <button class="btn btn-block" type="button" id="cal_btn" title=Apply>Apply</button>
                            </div>
                        </div>
                    </div>
                </div>

                <h4>
                    <div class="row"> 
                    <div class="col-md-6">
                        <a class="btn btn-block" type="button" id="reboot_btn" title=Reboot >Reboot</a>
                    </div>
					<div class="col-md-6">
                        <a class="btn btn-block" type="button" id="reset_btn" title=Reset > Factory Reset</a>
					</div>
					</div>
            </div>
        </div>
         </div>
        <script src=js/jquery-1.12.3.min.js> </script> <script src=js/bootstrap.min.js> </script> <script
            src=js/pixie-custom.js> </script> <script type="text/javascript">

                $(document).ready(function () {

                    $.get("/main").done(function (response) {
                        $("#txtmac").html(response.MAC);
                        $("#txtmyip").html(response.myIP);
                        $("#wsid").html(response.wsid);
                        $("#localip").html(response.localIP);
                        $("#txtssid").val(response.apname);
                        $("#txtaplan").val(response.myIP);
                    });

                    clicevent();
                });

                function clicevent() {

                    $(document).on("click", "#apply_btn", function () {
                        var txtaplan = $("#txtaplan").val();
                        var txtssid = $("#txtssid").val();
                        var txtpass = $("#txtpass").val();
                        $.get("/applyAP?txtaplan=" + txtaplan + "&txtssid=" + txtssid + "&txtpass=" + txtpass).done(function (response) {
                            if (response == "ok") {
                                alert("Please reboot the device to apply changes");
                            }
                            else if(response == "error") {
                                alert("Incorrect IP format");
                            }
                        });
                    });

                    $(document).on("click", "#set_pass", function () {
                        var newpassword = $("#admin_pass").val();
                        var confirmpassword = $("#confirm_pass1").val();
                        if (newpassword == confirmpassword) {
                            $.get("/adminpasswordfunction?confirmpassword=" + confirmpassword).done(function (response) {
                            })
                        }
                        else {
                            alert("Password should match");
                        }
                    });

                    $(document).on("click", "#scan_wifi", function () {
                        scanWifi();
                    });

                    $(document).on("click", "#service_btn", function () {
                        getServiceData();
                    });

                    $(document).on("click", "#ntp_btn", function () {
                        getNtpData();
                    });

                    $(document).on("click", "#con_btn", function () {
                        getNetWork();
                    });

                    $(document).on("click", "#cal_btn", function () {
                        getCalibration();
                    });
                    
                    $(document).on("click", "#getsamp1_btn", function () {
                        $.get("/sample").done( function(response){ 
                            if( response ) {
                                $("#ical0").val(response.adcval);
                            }
                            else {
                                console.log("response empty");
                            }
                        });
                    });

                    $(document).on("click", "#getsamp2_btn", function () {
                        $.get("/sample").done( function(response){ 
                            if( response ) {
                                $("#ical1").val(response.adcval);
                            }
                            else {
                                console.log("response empty");
                            }
                        });
                    });    

                    $(document).on('click', '#liService', function () {
                        setNtpData();
                        setServiceData();
                    });

                    $(document).on('click', '#liNetwork', function () {
                        setNetwork();
                        scanWifi();
                    });

                    $(document).on('click', '#liOther', function () {
                        setCalibration();
                    });

                    $(document).on("click", "#reboot_btn", function () {
                        var reboot_btn = "reboot_device";
                        $.get("/rebootbtnfunction?reboot_btn=" + reboot_btn).done(function (response) {
                            if (response == "ok") {
                                alert("After 5 second device restarted");
                            }
                        });
                    });

                    $(document).on("click", "#reset_btn", function () {
                        var reset_btn = "reset_device";
                        $.get("/resetbtnfunction?reset_btn=" + reset_btn).done(function (response) {
                            if (response == "ok") {
                                alert("Device is reseted");
                            }
                        });
                    });
                }

                function scanWifi() {
                    var scan_wifi = $("#scan_wifi").val();
                        $.get("/scanWifi?scan_wifi=" + scan_wifi).done(function (response) {
                            console.log(response)
                            if (response.length > 0) {
                                var html = "";
                                for (var item of response) {
                                    html = html + " <option value=" + item.ssid + ">" + item.ssid + "</option>";
                                }
                                $("#drpWLAN").html(html);
                            }
                    });
                }

                function getServiceData() {
                    let param = encodeURIComponent(
                        "{\"host\":\""     + $("#hipadd").val()                         + "\","
                            + "\"port\":"      + $("#port").val()                           + ","
                            + "\"id\":\""      + $("#c_id").val()                           + "\","
                            + "\"user\":\""    + $("#U_name").val()                         + "\","
                            + "\"pass\":\""    + $("#s_pass").val()                         + "\","
                            + "\"temp_tp\":\"" + $("#pub_topic_temp").val()                 + "\","
                            + "\"temp_tm\":"   + $("#interval_temp").val()                  + ","
                            + "\"temp_ud\":\"" + $("#u_interval_temp :selected").text()     + "\","
                            + "\"ping_tp\":\"" + $("#pub_topic_ping").val()                 + "\","
                            + "\"ping_tm\":"   + $("#interval_ping").val()                  + ","
                            + "\"ping_ud\":\"" + $("#u_interval_ping :selected").text()     + "\","
                            + "\"rel1_tp\":\"" + $("#sub_topic_rel1").val()                 + "\","
                            + "\"rel2_tp\":\"" + $("#sub_topic_rel2").val()                 + "\","
                            + "\"en_tp\":\""   + $("#sub_topic_en").val()                   + "\""
                            + "}"
                    );

                    if ($("#hipadd").val() == "" || $("#port").val() == "") {
                        alert("Host,Port can't be empty");
                    } 
                    else {
                        $.get("/applyService?parameters=" + param).done( function (response) {
                            if (response == "ok") {
                                alert("Applied settings");
                            }
                        });
                    }
                }

                function setServiceData() {
                    $.get("/serviceData").done( function(response){ 
                        if( response ) {
                            $("#hipadd").val(response.host);
                            $("#port").val(response.port);
                            $("#c_id").val(response.id);
                            $("#U_name").val(response.user);
                            $("#s_pass").val(response.pass);
                            $("#pub_topic_temp").val(response.temp_tp);
                            $("#interval_temp").val(response.temp_tm);
                            $("#u_interval_temp").val(response.temp_ud)
                            $("#pub_topic_ping").val(response.ping_tp);
                            $("#interval_ping").val(response.ping_tm);
                            $("#u_interval_ping").val(response.ping_ud)
                            $("#sub_topic_rel1").val(response.rel1_tp);
                            $("#sub_topic_rel2").val(response.rel2_tp);
                            $("#sub_topic_en").val(response.en_tp);
                        }
                        else {
                            console.log("response empty");
                        }
                    });
                }

                function getNetWork() {
                    var wifi_ssid = $("#drpWLAN :selected").text();
                    var wifi_pass = $("#wifi_pass").val();

                    let param = encodeURIComponent( 
                        "{\"wifi_ssid\":\""       + wifi_ssid                         + "\","
                            + "\"wifi_pass\":\""  + wifi_pass                         + "\","
                            + "\"wifi_MODE\":\""  + $("#wifi_MODE :selected").text()  + "\","
                            + "\"txtipadd\":\""   + $("#txtipadd").val()              + "\","
                            + "\"net_m\":\""      + $("#net_m").val()                 + "\","
                            + "\"G_add\":\""      + $("#G_add").val()                 + "\","
                            + "\"P_dns\":\""      + $("#P_dns").val()                 + "\","
                            + "\"S_dns\":\""      + $("#S_dns").val()                 + "\""
                            + "}"
                    );

                    if (wifi_ssid == "" || wifi_pass == "") {
                        alert("SSID and password can't be empty");
                    } 
                    else {
                        $.get("/applyNetwork?parameters=" + param ).done(function (response) {
                            if (response == "ok") {
                                alert("Applied settings");
                            }
                            else if(response == "error") {
                                alert("Incorrect IP format");
                            }
                        });
                    }
                }

                function setNetwork(){
                    $.get("/networkData").done( function(response){ 
                        if( response ) {
                            $("#wifi_MODE").val(response.mode);
                            $("#txtipadd").val(response.ip);
                            $("#net_m").val(response.nm);
                            $("#G_add").val(response.gw);
                            $("#P_dns").val(response.dns1);
                            $("#S_dns").val(response.dns2);
                        }
                        else {
                            console.log("response empty");
                        }
                    });
                }
                
                function getNtpData() {
                    let param = encodeURIComponent( 
                        "{\"host\":\""        + $("#hntp").val()       + "\","
                            + "\"port\":"     + $("#pntp").val()                           
                            + "}"
                    );

                    if ($("#host").val() == "" || $("#port").val() == "") {
                        alert("Host,Port can't be empty");
                    } 
                    else {
                        $.get("/applyNtp?parameters=" + param).done( function (response) {
                            if (response == "ok") {
                                alert("Applied settings");
                            }
                        });
                    }
                }

                function setNtpData() {
                    $.get("/ntpData").done( function(response){ 
                        if( response ) {
                            $("#hntp").val(response.host);
                            $("#pntp").val(response.port);
                        }
                        else {
                            console.log("response empty");
                        }
                    });
                }

                function getCalibration() {
                    let param = encodeURIComponent( 
                        "{\"x0\":"        + $("#ical0").val()        + ","
                            + "\"y0\":"   + $("#ocal0").val()        + ","
                            + "\"x1\":"   + $("#ical1").val()        + ","
                            + "\"y1\":"   + $("#ocal1").val()        + ","
                            + "\"owrite\":" + $("#defaultcal").is(":checked")
                            + "}"
                    );


                    $.get("/applyCalibration?parameters=" + param).done( function (response) {
                        if (response == "ok") {
                            alert("please reboot device to apply changes");
                        }
                    });
                }

                function setCalibration() {
                    $.get("/calibrationData").done( function(response){ 
                        if( response ) {
                            $("#ical0").val(response.x0);
                            $("#ocal0").val(response.y0);
                            $("#ical1").val(response.x1);
                            $("#ocal1").val(response.y1);
                        }
                        else {
                            console.log("response empty");
                        }
                    });
                }

                function Gateway_passFunction() {
                    var x = document.getElementById("txtpass");
                    if (x.type === "password") {
                        x.type = "text";
                    } 
                    else {
                        x.type = "password";
                    }
                }

                function Router_passFunction() {
                    var x = document.getElementById("wifi_pass");
                    if (x.type === "password") {
                        x.type = "text";
                    } 
                    else {
                        x.type = "password";
                    }
                }



            </script>

</body>

</html>